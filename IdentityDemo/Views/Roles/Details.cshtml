@using TenantsManagementApp.ViewModels
@using TenantsManagementApp.ViewModels.Roles
@model RoleDetailsViewModel
@{
ViewData["Title"] = "Role Details";
var totalUsers = Model.Users.TotalCount;
var totalClaims = Model.Claims?.Count;
var start = totalUsers == 0 ? 0 : ((Model.Users.PageNumber - 1) * Model.Users.PageSize) + 1;
var end = Math.Min(Model.Users.PageNumber * Model.Users.PageSize, totalUsers);
string FormatDate(DateTime? dt) => dt.HasValue ? dt.Value.ToString("dd MMM yyyy, HH:mm") : "-";
}
<div class="container mt-1">
<!-- Page Header -->
<div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-4 pb-2 border-bottom">
<div>
<h1 class="h3 mb-1 fw-bold text-primary">
Role: @Model.Name
</h1>
<p class="text-muted mb-0">
Role details, assigned users, and claims.
</p>
</div>
<div class="d-flex gap-2">
	<a asp-controller="Roles" asp-action="Index" class="btn btn-info">
		<i class="bi bi-arrow-left me-1"></i> Back to Roles
	</a>
	<a asp-controller="Roles" asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-success">
		<i class="bi bi-pencil-square me-1"></i> Edit Role
	</a>
	@if (User.IsInRole("Admin"))
	{
		<a asp-controller="Roles" asp-action="ManageUsers" asp-route-roleId="@Model.Id" class="btn btn-warning">
			<i class="bi bi-people me-1"></i> Manage Users
		</a>
	}
</div>
</div>
<div class="row g-3">
<!-- LEFT: Role Overview -->
<div class="col-lg-5">
<div class="card shadow-sm border-0 h-100">
<div class="card-body">
<h5 class="card-title mb-2">Role Overview</h5>
<div class="mb-1">
<div class="fw-semibold text-muted small">Description</div>
<div>@(string.IsNullOrWhiteSpace(Model.Description) ? "No description provided." : Model.Description)</div>
</div>
<div class="mb-1">
<div class="fw-semibold text-muted small">Status</div>
@if (Model.IsActive)
{
<span class="badge bg-success">Active</span>
<span class="text-muted ms-2 small">This role can be assigned to users.</span>
}
else
{
<span class="badge bg-secondary">Inactive</span>
<span class="text-muted ms-2 small">This role is currently disabled.</span>
}
</div>
<div class="row g-3">
<div class="col-6">
<div class="border rounded-3 p-3">
<div class="text-muted small">Created</div>
<div class="fw-semibold">@FormatDate(Model.CreatedOn)</div>
</div>
</div>
<div class="col-6">
<div class="border rounded-3 p-3">
<div class="text-muted small">Last Updated</div>
<div class="fw-semibold">@FormatDate(Model.ModifiedOn)</div>
</div>
</div>
</div>
<div class="mt-3 border rounded-3 p-3 bg-light">
<div class="text-muted small mb-1">Users Assigned</div>
<div class="h5 mb-0">@totalUsers</div>
</div>
<div class="mt-3 border rounded-3 p-3 bg-light">
<div class="text-muted small mb-1">Claims Assigned</div>
<div class="h5 mb-0">@totalClaims</div>
</div>
</div>
</div>
</div>
<!-- RIGHT: Users in Role + Role Claims (stacked) -->
<div class="col-lg-7 d-flex flex-column gap-1">
<!-- Role Claims (directly under Users list on the right) -->
<div class="card border-0 shadow">
<div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
<span class="fw-semibold">Role Claims</span>
<a asp-action="ManageClaims" asp-route-id="@Model.Id" class="btn btn-sm btn-primary">
<i class="bi bi-key me-1"></i> Manage Claims
</a>
</div>
<div class="card-body">
@if (Model.Claims == null || Model.Claims.Count == 0)
{
<div class="text-center text-muted py-3">
<i class="bi bi-key mb-2" style="font-size:1.4rem;"></i>
<div>No claims assigned to this role</div>
<div class="mt-2">
<a asp-action="ManageClaims" asp-route-id="@Model.Id" class="btn btn-sm btn-outline-primary">Assign Claims</a>
</div>
</div>
}
else
{
<div class="row row-cols-3 g-2">
@foreach (var claim in Model.Claims.OrderBy(x => x))
{
<div class="col">
<span class="badge rounded-pill bg-primary w-100 text-start px-3 py-2 fs-7 d-inline-flex align-items-center">
<i class="bi bi-check2-circle me-2"></i>@claim
</span>
</div>
}
</div>
}
</div>
</div>
<!-- Users in Role -->
<div class="card shadow-sm border-0">
<div class="card-body">
<div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-2">
<h5 class="card-title mb-0">Users in this Role</h5>
@if (totalUsers > 0)
{
<div class="text-muted small">Showing @start–@end of @totalUsers users</div>
}
</div>
@if (Model.Users.Items.Any())
{
<div class="table-responsive">
<table class="table table-sm table-hover align-middle mb-0">
<thead class="table-dark">
<tr>
<th style="width: 30%;">Name</th>
<th style="width: 34%;">Email</th>
<th style="width: 20%;">Phone</th>
<th style="width: 16%;">Status</th>
</tr>
</thead>
<tbody>
@foreach (var u in Model.Users.Items)
{
var fullName = $"{u.FirstName} {u.LastName}".Trim();
<tr>
<td>@(!string.IsNullOrWhiteSpace(fullName) ? fullName : "—")</td>
<td><span title="@u.Email">@u.Email</span></td>
<td>@(string.IsNullOrWhiteSpace(u.PhoneNumber) ? "—" : u.PhoneNumber)</td>
<td>
@if (u.IsActive)
{
<span class="badge bg-success">Active</span>
}
else
{
<span class="badge bg-secondary">Inactive</span>
}
</td>
</tr>
}
</tbody>
</table>
</div>
<partial name="~/Views/Shared/_Pager.cshtml"
model="new PagedResult<object> { Items = Array.Empty<object>(), TotalCount = Model.Users.TotalCount, PageNumber = Model.Users.PageNumber, PageSize = Model.Users.PageSize }" />
}
else
{
<div class="border rounded-3 p-4 text-center bg-light mt-2">
<div class="h5 mb-1">No users assigned to this role yet</div>
<div class="text-muted">Add users to <strong>@Model.Name</strong> from your user management page.</div>
</div>
}
</div>
</div>
</div>
</div>
</div>